{% extends "base.html" %} {% block title %}Home{% endblock %} {% block content%}

<!-- Start of sub-navbar -->
<br />
<br />
<ul class="nav nav-tabs">
  <li class="nav-item">
    <a class="nav-link active" aria-current="page" href="/course/{{data.COURSE}}"><small>{{data.COURSE}}</small></a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://kurser.dtu.dk/course/{{data.COURSE}}"><small><u></u>DTU's website</small></a>
  </li>
</ul>
<!-- End of sub-navbar -->

<!---->
<!---->

<!-- Start of course number and title -->
<br />
<br />
<h5>{{data.COURSE}} {{data.NAME}}</h5>
<!-- End of course number and title -->

<!-- Start of card grid -->
<div class="row row-cols-1 row-cols-xl-2 g-2">
  <div class="col">
    <!-- Start of first card -->
    <div class="card bg-light" style="max-width: 36rem;">
      <img src="{{ url_for('static', filename='assets/colors/grey.png') }}" width="100%" height="26"
        class="card-img-top" alt="..." />
      <ul class="list-group list-group-flush">
        <li class="list-group-item">
          <!-- Start of basic info table -->
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th style="width: 33%" scope="row">Danish Title:</th>
                <td class="align-top">{{data.DANISH_NAME}}</td>
              </tr>
              <tr>
                <th style="width: 33%" scope="row">Language:</th>
                <td class="align-top">{{data.LANGUAGE}}</td>
              </tr>
              <tr>
                <th style="width: 33%" scope="row">ECTS-points:</th>
                <td class="align-top">{{data.ECTS_POINTS}}</td>
              </tr>
              <tr>
                <th style="width: 33%" scope="row">Course type:</th>
                <td class="align-top">{{data.COURSE_TYPE}}</td>
              </tr>
              <tr>
                <th style="width: 33%" scope="row">Sign-ups:</th>
                <td class="align-top">{{data.STUDENTS_PER_SEMESTER}} students per semester</td>
              </tr>
              <tr>
                <th style="width: 33%" scope="row">Schedule:</th>
                <td class="align-top">{{data.TIME_OF_WEEK|safe}}</td>
              </tr>
            </tbody>
          </table>
          <!-- End of basic info table -->
        </li>
        <li class="list-group-item">
          <!-- Start of grade table -->
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              {% if 0 < data.TOTAL_STUDENTS %}
              <tr>
                <th style="width: 33%" scope="row">Grades:   <small class="fs-6 text-muted" data-toggle="modal"
                    data-target="#gradegraph_explainer" style="cursor: pointer;">[?]</small></th>
                <td>
                  <!-- Start of grade graph -->
                  <figure class="mb-0 mt-1">
                    <div class="graphic">
                      <div class="row">
                        <div class="chart">
                          <!-- Start of pass grade -->
                          {% if 0 < data.PASSED %}
                          <span class="block" data-toggle="modal" data-target="#gradegraph_explainer"
                            style="height: 16px; background-color: #01D93F; float: left; color: #01D93F00; position: relative; cursor: pointer;"
                            title="Grade 'Passed'">
                            <span class="value"
                              style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.PASSED) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                          <!-- End of pass grade -->
                          {% endif %}
                          <!-- Start of seven-step-grades -->
                          {% if 0 < data.GRADE_12 + data.GRADE_10 + data.GRADE_7 + data.GRADE_4 + data.GRADE_02 + data.GRADE_00 + data.GRADE_MINUS_3 %}

                          <span class="block" data-toggle="modal" data-target="#gradegraph_explainer"
                            style="height: 16px; background-color: #244710; float: left; color: #24471000; position: relative; cursor: pointer;"
                            title="Grade 12">
                            <span class="value"
                              style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_12) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                          <span class="block" data-toggle="modal" data-target="#gradegraph_explainer"
                            style="height: 16px; background-color: #1B791F; float: left; color: #1B791F00; position: relative; cursor: pointer;"
                            title="Grade 10">
                            <span class="value"
                              style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_10) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                          <span class="block" data-toggle="modal" data-target="#gradegraph_explainer"
                            style="height: 16px; background-color: #01D93F; float: left; color: #01D93F00; position: relative; cursor: pointer;"
                            title="Grade 7">
                            <span class="value"
                              style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_7) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                          <span class="block" data-toggle="modal" data-target="#gradegraph_explainer"
                            style="height: 16px; background-color: #FDBF02; float: left; color: #FDBF0200; position: relative; cursor: pointer;"
                            title="Grade 4">
                            <span class="value"
                              style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_4) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                          <span class="block" data-toggle="modal" data-target="#gradegraph_explainer"
                            style="height: 16px; background-color: #FE7E03; float: left; color: #FE7E0300; position: relative; cursor: pointer;"
                            title="Grade 02">
                            <span class="value"
                              style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_02) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                          <span class="block" data-toggle="modal" data-target="#gradegraph_explainer"
                            style="height: 16px; background-color: #D44B33; float: left; color: #D44B3300; position: relative; cursor: pointer;"
                            title="Grade 00">
                            <span class="value"
                              style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_00) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                          <span class="block" data-toggle="modal" data-target="#gradegraph_explainer"
                            style="height: 16px; background-color: #8E1600; float: left; color: #8E160000; position: relative; cursor: pointer;"
                            title="Grade -3">
                            <span class="value"
                              style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_MINUS_3) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                          <!-- End of seven-step-grades -->
                          {% endif %}
                          <!-- Start of failed grade -->
                          {% if 0 < data.FAILED + data.PASSED %}
                          <span class="block" data-toggle="modal" data-target="#gradegraph_explainer"
                            style="height: 16px; background-color: #8E1601; float: left; color: #8E160000; position: relative; cursor: pointer;"
                            title="Grade 'Failed'">
                            <span class="value"
                              style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.FAILED) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                          <!-- End of failed grade -->
                          {% endif %}
                          {% if 0 < data.ABSENT %}
                          <span class="block" data-toggle="modal" data-target="#gradegraph_explainer"
                            style="height: 16px; background-color: #989898; float: left; color: #98989800; position: relative; cursor: pointer;"
                            title="Absent from exam">
                            <span class="value"
                              style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.ABSENT) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  </figure>
                  <!-- End of grade graph -->
                </td>
              </tr>
              {% endif %}
            </tbody>
          </table>
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th style="width: 33%" scope="row">Average grade:</th>
                <td style="width: 15%" class="align-top">{{data.AVERAGE_GRADE}}</td>
                <td class="align-top"><small class="fs-6 text-muted">({{data.TOTAL_STUDENTS}} grades)</small></td>
              </tr>
              {% if 0 < data.TOTAL_STUDENTS %}
              <tr>
                <th style="width: 33%" scope="row">Failed students:</th>
                <td style="width: 15%" class="align-top">{{data.PERCENT_FAILED}}%</td>
                <td class="align-top"><small class="fs-6 text-muted">(+{{((100 * data.ABSENT) / data.TOTAL_STUDENTS)|round(1)}}% absent)</small></td>
              </tr>
              {% endif %}
            </tbody>
          </table>
          <!-- End of grade table -->
        </li>
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-middle" style="width: 33%" scope="row">Workload burden:</th>
                <td class="align-middle" style="width: 15%" >{{data.WORKLOAD_AVERAGE_SCORE}}</td>
                <td><img data-toggle="modal" data-target="#semester_breakdown" style="cursor: pointer" src="{{ url_for('static', filename='assets/ratings/' ~ data.WORKLOAD_TIER ~ '-skull.png') }}" height="36"></td>
              </tr>
              {% if 0 < data.LEARNING_VOTES %}
              <tr>
                <th style="width: 33%" scope="row">Overworked students:</th>
                <td style="width: 15%" class="align-top">{{(((100 * data.WORKLOAD_4_STAR) / data.LEARNING_VOTES) + ((100 * data.WORKLOAD_5_STAR) / data.LEARNING_VOTES))|round(1)}}%</td>
                <td class="align-top"><small class="fs-6 text-muted">({{((100 * data.WORKLOAD_4_STAR) / data.LEARNING_VOTES)|round(1)}}% mildly + {{((100 * data.WORKLOAD_5_STAR) / data.LEARNING_VOTES)|round(1)}}% severely)</small></td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </li>
        <li class="list-group-item">
          <!-- Start of old eval table -->
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th style="width: 33%" scope="row">Average rating:</th>
                <td style="width: 15%" class="align-top">{{data.RATING_AVERAGE_SCORE}}</td>
                {% if 10 <= data.MOTIVATION_VOTES or 0 == data.MOTIVATION_VOTES %}
                <td class="align-top"><small class="fs-6 text-muted">({{data.MOTIVATION_VOTES}} evaluations)</small></td>
                {% else %}
                <td class="align-top"><small class="fs-6 text-danger">({{data.MOTIVATION_VOTES}} evaluations) â€“ low sample size!</small></td>
                {% endif %}
              </tr>
              <tr>
                <td class="align-middle" style="width: 33%" scope="row"><i>"I have learned a lot"</i>:</td>
                <td class="align-middle" style="width: 15%" >{{data.LEARNING_AVERAGE_SCORE}}</td>
                <td><img data-toggle="modal" data-target="#semester_breakdown" style="cursor: pointer" src="{{ url_for('static', filename='assets/ratings/' ~ data.LEARNING_TIER ~ '-star.png') }}" height="36"></td>
              </tr>
              <tr>
                <td class="align-middle" style="width: 33%" scope="row"><i>"Motivating activities"</i>:</td>
                <td class="align-middle" style="width: 15%" >{{data.MOTIVATION_AVERAGE_SCORE}}</td>
                <td><img data-toggle="modal" data-target="#semester_breakdown" style="cursor: pointer" src="{{ url_for('static', filename='assets/ratings/' ~ data.MOTIVATION_TIER ~ '-star.png') }}" height="36"></td>
              </tr>
              <tr>
                <td class="align-middle" style="width: 33%" scope="row"><i>"Access to feedback"</i>:</td>
                <td class="align-middle" style="width: 15%" >{{data.FEEDBACK_AVERAGE_SCORE}}</td>
                <td><img data-toggle="modal" data-target="#semester_breakdown" style="cursor: pointer" src="{{ url_for('static', filename='assets/ratings/' ~ data.FEEDBACK_TIER ~ '-star.png') }}" height="36"></td>
              </tr>
            </tbody>
          </table>
          <!-- End of old eval table -->
        </li>
      </ul>
      <div class="card-footer">
        <small class="text-muted">Last updated: {{data.LAST_UPDATED}}</small>
      </div>
    </div>
    <!-- End of first card -->
  </div>
  <div class="col">
    <!-- Start of second card -->
    <div class="card bg-light" style="max-width: 24rem;">
      <img src="{{ url_for('static', filename='assets/colors/grey.png') }}" width="100%" height="26"
        class="card-img-top" alt="..." />
      <ul class="list-group list-group-flush">
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th style="width: 33%" scope="row">Responsible:</th>
                <td class="align-top">{{data.MAIN_RESPONSIBLE_NAME}}</td>
              </tr>
              <tr>
                <td style="width: 33%" scope="row">
                  <small class="fs-6">
                    <i>Courses</i>:
                  </small>
                  {% for course in data.MAIN_RESPONSIBLE_COURSES %}
                  <br /><a href="{{ url_for('.route_to_course', course_number=course) }}"><small class="fs-6 text-muted"><u>{{course}}</u></small></a>
                  {% endfor %}
                </td>
                <td class="align-top">
                  {% if data.MAIN_RESPONSIBLE_PIC != 'NO_DATA' %}
                  <img class="img-fluid" alt="100%x280" src="{{data.MAIN_RESPONSIBLE_PIC}}">
                  {% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </li>
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th style="width: 33%" scope="row">Exam type:</th>
                <td class="align-top">{{data.EXAM_TYPE}}</td>
              </tr>
              <tr>
                <th style="width: 33%" scope="row">Hand-ins:</th>
                <td class="align-top">{{data.ASSIGNMENTS}}</td>
              </tr>
            </tbody>
          </table>
        </li>
      </ul>
      <div class="card-body">
        <button type="button" class="btn btn-outline-dark"  data-toggle="modal" data-target="#gradegraph_explainer">Grade distribution</button>
        <button type="button" class="btn btn-outline-dark"  data-toggle="modal" data-target="#semester_breakdown">Semester breakdown</button>
      </div>
      <ul class="list-group list-group-flush">
        {% if data.CO_RESPONSIBLE_1_NAME != 'NO_DATA' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th style="width: 33%" scope="row">Responsible:</th>
                <td class="align-top">{{data.CO_RESPONSIBLE_1_NAME}}</td>
              </tr>
              <tr>
                <td style="width: 33%" scope="row">
                  <small class="fs-6">
                    <i>Courses</i>:
                  </small>
                  {% for course in data.CO_RESPONSIBLE_1_COURSES %}
                  <br /><a href="{{ url_for('.route_to_course', course_number=course) }}"><small class="fs-6 text-muted"><u>{{course}}</u></small></a>
                  {% endfor %}
                </td>
                <td class="align-top">
                  {% if data.CO_RESPONSIBLE_1_PIC != 'NO_DATA' %}
                  <img class="img-fluid" alt="100%x280" src="{{data.CO_RESPONSIBLE_1_PIC}}">
                  {% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.CO_RESPONSIBLE_2_NAME != 'NO_DATA' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th style="width: 33%" scope="row">Responsible:</th>
                <td class="align-top">{{data.CO_RESPONSIBLE_2_NAME}}</td>
              </tr>
              <tr>
                <td style="width: 33%" scope="row">
                  <small class="fs-6">
                    <i>Courses</i>:
                  </small>
                  {% for course in data.CO_RESPONSIBLE_2_COURSES %}
                  <br /><a href="{{ url_for('.route_to_course', course_number=course) }}"><small class="fs-6 text-muted"><u>{{course}}</u></small></a>
                  {% endfor %}
                </td>
                <td class="align-top">
                  {% if data.CO_RESPONSIBLE_2_PIC != 'NO_DATA' %}
                  <img class="img-fluid" alt="100%x280" src="{{data.CO_RESPONSIBLE_2_PIC}}">
                  {% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.CO_RESPONSIBLE_3_NAME != 'NO_DATA' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th style="width: 33%" scope="row">Responsible:</th>
                <td class="align-top">{{data.CO_RESPONSIBLE_3_NAME}}</td>
              </tr>
              <tr>
                <td style="width: 33%" scope="row">
                  <small class="fs-6">
                    <i>Courses</i>:
                  </small>
                  {% for course in data.CO_RESPONSIBLE_3_COURSES %}
                  <br /><a href="{{ url_for('.route_to_course', course_number=course) }}"><small class="fs-6 text-muted"><u>{{course}}</u></small></a>
                  {% endfor %}
                </td>
                <td class="align-top">
                  {% if data.CO_RESPONSIBLE_3_PIC != 'NO_DATA' %}
                  <img class="img-fluid" alt="100%x280" src="{{data.CO_RESPONSIBLE_3_PIC}}">
                  {% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.CO_RESPONSIBLE_4_NAME != 'NO_DATA' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th style="width: 33%" scope="row">Responsible:</th>
                <td class="align-top">{{data.CO_RESPONSIBLE_4_NAME}}</td>
              </tr>
              <tr>
                <td style="width: 33%" scope="row">
                  <small class="fs-6">
                    <i>Courses</i>:
                  </small>
                  {% for course in data.CO_RESPONSIBLE_4_COURSES %}
                  <br /><a href="{{ url_for('.route_to_course', course_number=course) }}"><small class="fs-6 text-muted"><u>{{course}}</u></small></a>
                  {% endfor %}
                </td>
                <td class="align-top">
                  {% if data.CO_RESPONSIBLE_4_PIC != 'NO_DATA' %}
                  <img class="img-fluid" alt="100%x280" src="{{data.CO_RESPONSIBLE_4_PIC}}">
                  {% endif %}
                </td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
      </ul>
      <div class="card-footer">
        <small class="text-muted">Last updated: {{data.LAST_UPDATED}}</small>
      </div>
    </div>
    <!-- End of second card -->
  </div>
</div>
<!-- End of card grid -->




<!-- Start of additional information title -->
<br />
<br />
<br />
<h5>Additional information:</h5>
<!-- End of additional information title -->

<!-- Start of additional information -->
<div class="row row-cols-1 row-cols-xl-1 g-1">
  <div class="col">
    <div class="card bg-light" style="max-width: 54rem;">
      <img src="{{ url_for('static', filename='assets/colors/grey.png') }}" width="100%" height="26"
        class="card-img-top" alt="..." />
      <ul class="list-group list-group-flush">
        {% if data.COURSE_DESCRIPTION != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Description:</th>
                <td class="align-top">{{data.COURSE_DESCRIPTION|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.CAMPUS_RAW != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Location:</th>
                <td class="align-top">{{data.CAMPUS_RAW|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.LEGACY_RECOMMENDED_PREREQUISITES != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Prerequisites:   <small class="fs-6 text-muted" data-toggle="modal"
                  data-target="#course_graph_modal" onclick="initCourseGraph()" style="cursor: pointer;">[+]</small></th>
                <td class="align-top">{{data.LEGACY_RECOMMENDED_PREREQUISITES|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.RECOMMENDED_PREREQUISITES != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Prerequisites:   <small class="fs-6 text-muted" data-toggle="modal"
                  data-target="#course_graph_modal" onclick="initCourseGraph()" style="cursor: pointer;">[+]</small></th>
                <td class="align-top">{{data.RECOMMENDED_PREREQUISITES|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.MANDATORY_PREREQUISITES != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Prerequisites:   <small class="fs-6 text-muted" data-toggle="modal"
                  data-target="#course_graph_modal" onclick="initCourseGraph()" style="cursor: pointer;">[+]</small></th>
                <td class="align-top">{{data.MANDATORY_PREREQUISITES|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if (data.MANDATORY_PREREQUISITES == 'None' and data.RECOMMENDED_PREREQUISITES == 'None') %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Prerequisites:   <small class="fs-6 text-muted" data-toggle="modal"
                  data-target="#course_graph_modal" onclick="initCourseGraph()" style="cursor: pointer;">[+]</small></th>
                <td class="align-top">No prerequisites required</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.SUBSEQUENT_COURSES != 'No other course requires this as a prerequisite' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Prerequisite to:</th>
                <td class="align-top">{{data.SUBSEQUENT_COURSES|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.SCOPE_AND_FORM != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Scope and form:</th>
                <td class="align-top">{{data.SCOPE_AND_FORM|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.STUDY_LINES != 'Not linked to any study lines<br />Unknown data value' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Study lines:</th>
                <td class="align-top">{{data.STUDY_LINES|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.HOME_PAGE != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Webpage:</th>
                <td class="align-top">{{data.HOME_PAGE|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.EXAM_TYPE_RAW != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Exam info:</th>
                <td class="align-top">{{data.EXAM_TYPE_RAW|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.EXAM_AID_RAW != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Aid:</th>
                <td class="align-top">{{data.EXAM_AID_RAW|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.EXAM_DURATION != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Duration:</th>
                <td class="align-top">{{data.EXAM_DURATION|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.OBJECTIVES != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Objectives:</th>
                <td class="align-top">{{data.LEARNING_OBJECTIVES|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.COURSE_CONTENT != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Content:</th>
                <td class="align-top">{{data.COURSE_CONTENT|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.REMARKS != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Teacher's note:</th>
                <td class="align-top">{{data.REMARKS|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
        {% if data.HIGHLIGHTED_MESSAGE != 'None' %}
        <li class="list-group-item">
          <table class="table table-sm table-borderless mb-0">
            <tbody>
              <tr>
                <th class="align-top" style="width: 9rem" scope="row">Special remark:</th>
                <td class="align-top">{{data.HIGHLIGHTED_MESSAGE|safe}}</td>
              </tr>
            </tbody>
          </table>
        </li>
        {% endif %}
      </ul>
      <div class="card-footer">
        <small class="text-muted">Last updated: {{data.LAST_UPDATED}}</small>
      </div>
    </div>
  </div>
</div>
<!-- End of additional information -->

<!-- Start of modal: semester breakdown -->
<div class="modal fade" id="semester_breakdown" tabindex="-1" role="dialog"
  aria-labelledby="semester_breakdown_label" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="semester_breakdown_id">Semester breakdown</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        The average grade for {{data.COURSE}} (semester overview):
        <table class="table table-sm table-striped mt-2 mb-0">
          <thead>
            <tr>
              <th></th>
              <th class="align-top">Grade</td>
              <th class="align-top">Failed</td>
              <th class="align-top">Students</td>
            </tr>
          </thead>
          <tbody>
          {% for semester, semester_data in semesters.items() %}
          {% if semester_data.TOTAL_STUDENTS and (0.05 * data.TOTAL_STUDENTS) < semester_data.TOTAL_STUDENTS %}
          <tr>
            <th style="width: 33%" scope="row">{{semester_data.SEMESTER_NAME}}</th>
            <td class="align-top">{{semester_data.AVERAGE_GRADE}}</td>
            <td class="align-top">{{semester_data.PERCENT_FAILED}}%</td>
            <td class="align-top">{{semester_data.TOTAL_STUDENTS}}</td>
          </tr>
          {% endif %}
          {% endfor %}
          </tbody>
          {% if (0.05 * data.TOTAL_STUDENTS) < data.TOTAL_STUDENTS %}
          <tfoot>
            <tr>
              <th style="width: 33%" scope="row">All semesters</th>
              <td class="align-top">{{data.AVERAGE_GRADE}}</td>
              <td class="align-top">{{data.PERCENT_FAILED}}%</td>
              <td class="align-top">{{data.TOTAL_STUDENTS}}</td>
            </tr>
          </tfoot>
          {% endif %}
        </table>

        <br>
        The evaluation ratings for {{data.COURSE}} (semester overview):
        <br>
        Category A: <i>"Course workload"</i>
        <br>
        Category B: <i>"I have learned a lot"</i>
        <br>
        Category C: <i>"Motivating activities"</i>
        <br>
        Category D: <i>"Access to feedback"</i>
        <table class="table table-sm table-striped mt-2 mb-0">
          <thead>
            <tr>
              <th></th>
              <th class="align-top">A</td>
              <th class="align-top">B</td>
              <th class="align-top">C</td>
              <th class="align-top">D</td>
              <th class="align-top">Votes</td>
            </tr>
          </thead>
          <tbody>
            {% for semester, semester_data in semesters.items() %}
            {% if 0 < semester_data.LEARNING_VOTES %}
            <tr>
              <th style="width: 33%" scope="row">{{semester_data.SEMESTER_NAME}}</th>
              <td class="align-top">{{semester_data.WORKLOAD_AVERAGE_SCORE}}</td>
              <td class="align-top">{{semester_data.LEARNING_AVERAGE_SCORE}}</td>
              <td class="align-top">{{semester_data.MOTIVATION_AVERAGE_SCORE}}</td>
              <td class="align-top">{{semester_data.FEEDBACK_AVERAGE_SCORE}}</td>
              <td class="align-top">{{semester_data.LEARNING_VOTES}}</td>
            </tr>
            {% endif %}
            {% endfor %}
          </tbody>
          {% if 0 < data.LEARNING_VOTES %}
          <tfoot>
            <tr>
              <th style="width: 33%" scope="row">All semesters</th>
              <td class="align-top">{{data.WORKLOAD_AVERAGE_SCORE}}</td>
              <td class="align-top">{{data.LEARNING_AVERAGE_SCORE}}</td>
              <td class="align-top">{{data.MOTIVATION_AVERAGE_SCORE}}</td>
              <td class="align-top">{{data.FEEDBACK_AVERAGE_SCORE}}</td>
              <td class="align-top">{{data.LEARNING_VOTES}}</td>
            </tr>
          </tfoot>
          {% endif %}
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- End of modal: gradegraph explainer -->

<!-- Start of modal: gradegraph explainer -->
<div class="modal fade" id="gradegraph_explainer" tabindex="-1" role="dialog"
  aria-labelledby="gradegraph_explainer_label" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Grade distribution</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        The stacked bar chart visualizes the grade distribution for {{data.COURSE}}. Each grade is color-coded based on
        the table below:
        <table class="table table-sm mt-2 mb-0">
          <thead>
            <tr>
              <th style="width: 6em" scope="row">
                <div
                  style="content: ''; margin-right: .5em; display: inline-block; width: 10px; height: 10px; background-color: #FFFFFF;">
                </div> Grade</th>
              <th colspan="2">Distribution</th>
              <th style="width: 3em"></th>
            </tr>
          </thead>
          <tbody>
            <!-- Start of pass grades -->
            {% if 0 < data.PASSED %}
            <tr>
              <td scope="row">
                <div
                  style="content: ''; margin-right: .5em; display: inline-block; width: 10px; height: 10px; background-color: #01D93F;">
                </div> <i>"Pass"</i></th>
              <td style="width: 4em">{{((100 * data.PASSED) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</td>
              <td>
                <figure class="mb-0 mt-1">
                  <div class="graphic">
                    <div class="row">
                      <div class="chart">
                        <span class="block"
                        style="height: 18px; background-color: #01D93F; float: left; color: #01D93F00; position: relative;"
                        title="Pass">
                          <span class="value"
                            style="font-size: x-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.PASSED) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </figure>
              </td>
              <td style="width: 3em"><small class="fs-6 text-muted">({{data.PASSED}})</small></td>
            </tr>
            <!-- End of pass grades -->
            {% endif %}
            <!-- Start of seven_step_grades -->
            {% if 0 < data.GRADE_12 + data.GRADE_10 + data.GRADE_7 + data.GRADE_4 + data.GRADE_02 + data.GRADE_00 + data.GRADE_MINUS_3 %}
            <tr>
              <td scope="row">
                <div
                  style="content: ''; margin-right: .5em; display: inline-block; width: 10px; height: 10px; background-color: #244710;">
                </div> 12</th>
              <td style="width: 4em">{{((100 * data.GRADE_12) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</td>
              <td>
                <figure class="mb-0 mt-1">
                  <div class="graphic">
                    <div class="row">
                      <div class="chart">
                        <span class="block"
                          style="height: 18px; background-color: #244710; float: left; color: #24471000; position: relative;"
                          title="Grade 12">
                          <span class="value"
                            style="font-size: x-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_12) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </figure>
              </td>
              <td style="width: 3em"><small class="fs-6 text-muted">({{data.GRADE_12}})</small></td>
            </tr>
            <tr>
              <td scope="row">
                <div
                  style="content: ''; margin-right: .5em; display: inline-block; width: 10px; height: 10px; background-color: #1B791F;">
                </div> 10</th>
              <td style="width: 4em">{{((100 * data.GRADE_10) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</td>
              <td>
                <figure class="mb-0 mt-1">
                  <div class="graphic">
                    <div class="row">
                      <div class="chart">
                        <span class="block"
                        style="height: 18px; background-color: #1B791F; float: left; color: #1B791F00; position: relative;"
                        title="Grade 10">
                          <span class="value"
                            style="font-size: x-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_10) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </figure>
              </td>
              <td style="width: 3em"><small class="fs-6 text-muted">({{data.GRADE_10}})</small></td>
            </tr>
            <tr>
              <td scope="row">
                <div
                  style="content: ''; margin-right: .5em; display: inline-block; width: 10px; height: 10px; background-color: #01D93F;">
                </div> 7</th>
              <td style="width: 4em">{{((100 * data.GRADE_7) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</td>
              <td>
                <figure class="mb-0 mt-1">
                  <div class="graphic">
                    <div class="row">
                      <div class="chart">
                        <span class="block"
                        style="height: 18px; background-color: #01D93F; float: left; color: #01D93F00; position: relative;"
                        title="Grade 7">
                          <span class="value"
                            style="font-size: x-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_7) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </figure>
              </td>
              <td style="width: 3em"><small class="fs-6 text-muted">({{data.GRADE_7}})</small></td>
            </tr>
            <tr>
              <td scope="row">
                <div
                  style="content: ''; margin-right: .5em; display: inline-block; width: 10px; height: 10px; background-color: #FDBF02;">
                </div> 4</th>
              <td style="width: 4em">{{((100 * data.GRADE_4) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</td>
              <td>
                <figure class="mb-0 mt-1">
                  <div class="graphic">
                    <div class="row">
                      <div class="chart">
                        <span class="block"
                        style="height: 18px; background-color: #FDBF02; float: left; color: #FDBF0200; position: relative;"
                        title="Grade 4">
                          <span class="value"
                            style="font-size: x-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_4) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </figure>
              </td>
              <td style="width: 3em"><small class="fs-6 text-muted">({{data.GRADE_4}})</small></td>
            </tr>
            <tr>
              <td scope="row">
                <div
                  style="content: ''; margin-right: .5em; display: inline-block; width: 10px; height: 10px; background-color: #FE7E03;">
                </div> 02</th>
              <td style="width: 4em">{{((100 * data.GRADE_02) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</td>
              <td>
                <figure class="mb-0 mt-1">
                  <div class="graphic">
                    <div class="row">
                      <div class="chart">
                        <span class="block"
                        style="height: 18px; background-color: #FE7E03; float: left; color: #FE7E0300; position: relative;"
                        title="Grade 02">
                          <span class="value"
                            style="font-size: x-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_02) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </figure>
              </td>
              <td style="width: 3em"><small class="fs-6 text-muted">({{data.GRADE_02}})</small></td>
            </tr>
            <tr>
              <td scope="row">
                <div
                  style="content: ''; margin-right: .5em; display: inline-block; width: 10px; height: 10px; background-color: #D44B33;">
                </div> 00</th>
              <td style="width: 4em">{{((100 * data.GRADE_00) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</td>
              <td>
                <figure class="mb-0 mt-1">
                  <div class="graphic">
                    <div class="row">
                      <div class="chart">
                        <span class="block"
                        style="height: 18px; background-color: #D44B33; float: left; color: #D44B3300; position: relative;"
                        title="Grade 00">
                          <span class="value"
                            style="font-size: x-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_00) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </figure>
              </td>
              <td style="width: 3em"><small class="fs-6 text-muted">({{data.GRADE_00}})</small></td>
            </tr>
            <tr>
              <td scope="row">
                <div
                  style="content: ''; margin-right: .5em; display: inline-block; width: 10px; height: 10px; background-color: #8E1600;">
                </div> -3</th>
              <td style="width: 4em">{{((100 * data.GRADE_MINUS_3) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</td>
              <td>
                <figure class="mb-0 mt-1">
                  <div class="graphic">
                    <div class="row">
                      <div class="chart">
                        <span class="block"
                        style="height: 18px; background-color: #8E1600; float: left; color: #8E160000; position: relative;"
                        title="Grade -3">
                          <span class="value"
                            style="font-size: x-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_MINUS_3) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </figure>
              </td>
              <td style="width: 3em"><small class="fs-6 text-muted">({{data.GRADE_MINUS_3}})</small></td>
            </tr>
            <!-- End of seven_step_grades -->
            {% endif %}
            <!-- Start of fail grades -->
            {% if 0 < data.FAILED + data.PASSED %}
            <tr>
              <td scope="row">
                <div
                  style="content: ''; margin-right: .5em; display: inline-block; width: 10px; height: 10px; background-color: #8E1600;">
                </div> <i>"Fail"</i></th>
              <td style="width: 4em">{{((100 * data.FAILED) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</td>
              <td>
                <figure class="mb-0 mt-1">
                  <div class="graphic">
                    <div class="row">
                      <div class="chart">
                        <span class="block"
                        style="height: 18px; background-color: #8E1600; float: left; color: #8E160000; position: relative;"
                        title="Fail">
                          <span class="value"
                            style="font-size: x-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.FAILED) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </figure>
              </td>
              <td style="width: 3em"><small class="fs-6 text-muted">({{data.FAILED}})</small></td>
            </tr>
            <!-- End of fail grades -->
            {% endif %}
            <!-- Start of absent grade -->
            {% if 0 < data.ABSENT %}
            <tr>
              <td scope="row">
                <div
                  style="content: ''; margin-right: .5em; display: inline-block; width: 10px; height: 10px; background-color: #989898;">
                </div> Absent</th>
              <td style="width: 4em">{{((100 * data.ABSENT) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</td>
              <td>
                <figure class="mb-0 mt-1">
                  <div class="graphic">
                    <div class="row">
                      <div class="chart">
                        <span class="block"
                        style="height: 18px; background-color: #989898; float: left; color: #8E160000; position: relative;"
                        title="Absent from exam">
                          <span class="value"
                            style="font-size: x-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.ABSENT) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                        </span>
                      </div>
                    </div>
                  </div>
                </figure>
              </td>
              <td style="width: 3em"><small class="fs-6 text-muted">({{data.ABSENT}})</small></td>
            </tr>
            <!-- End of absent grade -->
            {% endif %}
          </tbody>
          <tfoot>
            <tr>
              <th scope="row">
                <div
                  style="content: ''; margin-right: .5em; display: inline-block; width: 10px; height: 10px; background-color: #ffffff;">
                </div> Total</th>
                <td style="width: 4em"></td>
                <td>
                <!-- Start of grade graph -->
                <figure class="mb-0 mt-1">
                  <div class="graphic">
                    <div class="row">
                      <div class="chart">
                        <!-- Start of pass grade -->
                        {% if 0 < data.PASSED %}
                        <span class="block"
                        style="height: 18px; background-color: #01D93F; float: left; color: #01D93F00; position: relative; cursor: pointer;"
                        title="Grade 'Passed'">
                          <span class="value"
                            style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.PASSED) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                        </span>
                        <!-- End of pass grade -->
                        {% endif %}
                        <!-- Start of seven-step-grades -->
                        {% if 0 < data.GRADE_12 + data.GRADE_10 + data.GRADE_7 + data.GRADE_4 + data.GRADE_02 + data.GRADE_00 + data.GRADE_MINUS_3 %}
                        <span class="block"
                          style="height: 18px; background-color: #244710; float: left; color: #24471000; position: relative; cursor: pointer;"
                          title="Grade 12">
                          <span class="value"
                            style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_12) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                        </span>
                        <span class="block"
                          style="height: 18px; background-color: #1B791F; float: left; color: #1B791F00; position: relative; cursor: pointer;"
                          title="Grade 10">
                          <span class="value"
                            style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_10) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                        </span>
                        <span class="block"
                          style="height: 18px; background-color: #01D93F; float: left; color: #01D93F00; position: relative; cursor: pointer;"
                          title="Grade 7">
                          <span class="value"
                            style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_7) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                        </span>
                        <span class="block"
                          style="height: 18px; background-color: #FDBF02; float: left; color: #FDBF0200; position: relative; cursor: pointer;"
                          title="Grade 4">
                          <span class="value"
                            style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_4) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                        </span>
                        <span class="block"
                          style="height: 18px; background-color: #FE7E03; float: left; color: #FE7E0300; position: relative; cursor: pointer;"
                          title="Grade 02">
                          <span class="value"
                            style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_02) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                        </span>
                        <span class="block"
                          style="height: 18px; background-color: #D44B33; float: left; color: #D44B3300; position: relative; cursor: pointer;"
                          title="Grade 00">
                          <span class="value"
                            style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_00) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                        </span>
                        <span class="block"
                          style="height: 18px; background-color: #8E1600; float: left; color: #8E160000; position: relative; cursor: pointer;"
                          title="Grade -3">
                          <span class="value"
                            style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.GRADE_MINUS_3) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                        </span>
                        <!-- End of seven-step-grades -->
                        {% endif %}
                        <!-- Start of failed grade -->
                        {% if 0 < data.FAILED %}
                        <span class="block"
                        style="height: 18px; background-color: #8E1600; float: left; color: #8E160000; position: relative; cursor: pointer;"
                        title="Grade 'Failed'">
                          <span class="value"
                            style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.FAILED) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                          </span>
                        </span>
                        <!-- End of failed grade -->
                        {% endif %}
                        {% if 0 < data.ABSENT %}
                        <span class="block"
                          style="height: 18px; background-color: #989898; float: left; color: #98989800; position: relative; cursor: pointer;"
                          title="Absent from exam">
                          <span class="value"
                            style="font-size: xx-small; line-height: 0em; position: absolute; top: 50%; left: 50%; transform: translate(-50%);">{{((100 * data.ABSENT) / data.TOTAL_STUDENTS)|round(1, 'floor')}}%</span>
                        </span>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </figure>
                <!-- End of grade graph -->
              </td>
              <td style="width: 3em"><small class="fs-6 text-muted">({{data.TOTAL_STUDENTS}})</small></td>
            </tr>
          </tfoot>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- End of modal: gradegraph explainer -->

<!-- Start of custom javascripts -->
<script src="{{ url_for('static', filename='assets/dist/js/gradegraph.js') }}"></script>
<!-- End of custom javascripts -->

<!-- Start of modal: Course Graph -->
<div class="modal fade" id="course_graph_modal" tabindex="-1" role="dialog" aria-labelledby="course_graph_label" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="course_graph_label">Course dependency graph</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" style="position: relative; min-height: 400px; overflow-x: auto;">
        <!-- The graph will be injected here by JS -->
        <div id="graph-container" style="width: 100%; min-width: 100%; position: relative;">
            <div class="text-center mt-5"><div class="spinner-border" role="status"></div><br>Loading graph data...</div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- End of modal: Course Graph -->

<style>
  /* Friend's CSS adapted */
  .tooltip-link {
    position: relative;
    color: #000000;
    text-decoration: none;
    display: inline-block;
    padding: 2px;
  }
  .tooltip-link .tooltip-text {
    visibility: hidden;
    opacity: 0;
    background-color: rgba(255, 255, 255, 0.95);
    color: black;
    border: 1px solid #b50404;
    border-radius: 6px;
    padding: 5px 10px;
    position: absolute;
    z-index: 1000;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    font-size: 12px;
    font-weight: normal;
    white-space: nowrap;
    box-shadow: 0px 2px 8px rgba(0,0,0,0.15);
    transition: opacity 0.3s ease;
    pointer-events: none;
  }
  .tooltip-link:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
  }
  /* Graph specific table styles */
  .graph-section-table td {
    padding: 5px;
    position: relative;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    let graphData = null;
    let nameMapping = null;
    const courseId = "{{data.COURSE}}".trim();

    // Global function to be called by the button onclick
    window.initCourseGraph = async function () {
      console.log("Init Course Graph triggered");
      const container = document.getElementById('graph-container');

      // Load data if not loaded
      if (!nameMapping) {
        try {
          container.innerHTML = `<div class="text-center mt-5"><div class="spinner-border" role="status"></div><br>Loading graph data...</div>`;

          const [mapRes, graphRes] = await Promise.all([
            fetch('https://raw.githubusercontent.com/Marcrulo/DTU-courses-extension/master/jsons/id_to_name.json'),
            fetch('https://raw.githubusercontent.com/Marcrulo/DTU-courses-extension/master/jsons/graphs.json')
          ]);
          if (!mapRes.ok || !graphRes.ok) throw new Error("Network response was not ok");
          nameMapping = await mapRes.json();
          const allGraphs = await graphRes.json();

          if (allGraphs[courseId]) {
            graphData = allGraphs[courseId];
          } else {
            graphData = null;
          }
        } catch (err) {
          container.innerHTML = `<p class='text-danger text-center p-4'>Error loading data.<br><small>${err.message}</small></p>`;
          return;
        }
      }

      if (!graphData) {
        container.innerHTML = `
        <div class="alert alert-secondary text-center mt-4">
        <strong>No graph data is available for ${courseId}.</strong><br>
        This feature is provided by the <a href="https://github.com/Marcrulo/DTU-courses-extension" style="color: #990000; text-decoration: none;" target="_blank">DTU-courses-extension</a>, and data for this course is not yet available.
          </div>`;
        return;
      }

      // Calculate grid data immediately to check structure, though we might not render yet
      const { t_prereq, t_subseq } = buildGrid(graphData);
      const nodeCount = graphData.nodes ? graphData.nodes.length : 0;
      const NODE_THRESHOLD = 50;

      // Function to actually render the HTML and draw lines
      const renderGraph = () => {
        // Build HTML structure: SVG Layer BEHIND Content Layer
        let html = `
          <div class="alert alert-light text-center" style="font-size: 0.9em; color: gray;">
            The graphs show all prerequisite relationships leading to and from the given course.<br>
            Outdated courses that are no longer being offered is not displayed.
          </div>

          <div id="svg-wrapper" style="position: relative;">
            <!-- SVG Layer -->
            <svg id="graph-svg" style="position: absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index: 0;">
              <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                  <polygon points="0 0, 10 3.5, 0 7" fill="rgba(181, 4, 4, 0.3)" />
                </marker>
              </defs>
            </svg>

            <!-- Content Layer -->
            <div style="position: relative; z-index: 1;">
              <h6 class="text-center border-bottom pb-2">Prerequisites</h6>
              <div id="prereq-area" style="min-height: 50px; margin-bottom: 20px;">
                ${generateTableHTML(t_prereq, 'prereq')}
              </div>

              <h6 class="text-center border-bottom pb-2 border-top pt-2">Subsequent Courses</h6>
              <div id="subseq-area" style="min-height: 50px;">
                ${generateTableHTML(t_subseq, 'subseq')}
              </div>
            </div>
          </div>

          <div class="text-center mt-4" style="font-size: 11px; color: #888;">
            Data is based on <a href="https://github.com/Marcrulo/DTU-courses-extension" style="color: #888; text-decoration: none;" target="_blank">DTU-courses-extension</a> by Marcus Presutti.
          </div>
        `;

        container.innerHTML = html;

        // Wait for modal transition/DOM update to finish before drawing lines
        setTimeout(() => {
          drawSVGLines(t_prereq, 'prereq');
          drawSVGLines(t_subseq, 'subseq');
        }, 200);
      };

      // Logic to handle large graphs
      if (nodeCount > NODE_THRESHOLD) {
        container.innerHTML = `
          <div class="d-flex flex-column align-items-center justify-content-center" style="height: 300px;">
            <h4 class="text-danger mb-3">Large graph warning</h4>
            <p class="text-muted text-center px-4">
              This dependency graph contains <strong>${nodeCount}</strong> courses.<br>
            </p>
            <button id="show-graph-anyway-btn" class="btn btn-outline-danger mt-2">
              Show anyway
            </button>
          </div>
        `;
        // Attach click listener to the new button
        document.getElementById('show-graph-anyway-btn').onclick = renderGraph;
      } else {
        // Small graph, render immediately
        renderGraph();
      }
    };

    function buildGrid(graph) {
      if (!graph) return { t_prereq: [], t_subseq: [] };
      const { max_subseq = 0, max_prereq = 0, subseq_height = 0, prereq_height = 0 } = graph;
      let t_prereq = Array.from({ length: prereq_height }, () => Array(max_prereq + 1).fill(null));
      let t_subseq = Array.from({ length: subseq_height }, () => Array(max_subseq + 1).fill(null));
      const rowTrackerP = {};
      const rowTrackerS = {};

      for (const { id, level } of graph.nodes) {
        if (level < 0) {
          if (!(level in rowTrackerP)) rowTrackerP[level] = 0;
          t_prereq[rowTrackerP[level]][max_prereq + level] = id;
          rowTrackerP[level]++;
        } else if (level > 0) {
          if (!(level in rowTrackerS)) rowTrackerS[level] = 0;
          t_subseq[rowTrackerS[level]][level] = id;
          rowTrackerS[level]++;
        }
      }
      if (prereq_height > 0) t_prereq[0][max_prereq] = courseId;
      if (subseq_height > 0) t_subseq[0][0] = courseId;

      for (let row of t_prereq) for (let j = 1; j < row.length; j += 2) row.splice(j, 0, null);
      for (let row of t_subseq) for (let j = 1; j < row.length; j += 2) row.splice(j, 0, null);

      const centerCols = (table) => {
        const rows = table.length, cols = table[0]?.length || 0;
        for (let c = 0; c < cols; c++) {
          let vals = [];
          for (let r = 0; r < rows; r++) if (table[r][c] !== null) vals.push(table[r][c]);
          if (!vals.length) continue;
          vals.sort();
          const pad = Math.floor((rows - vals.length) / 2);
          for (let r = 0; r < rows; r++) table[r][c] = (r >= pad && r < pad + vals.length) ? vals[r - pad] : null;
        }
      };
      centerCols(t_prereq);
      centerCols(t_subseq);
      return { t_prereq, t_subseq };
    }

    function generateTableHTML(grid, type) {
      const labelMap = {
        prereq: "prerequisite",
        subseq: "subsequent"
      };
      const label = labelMap[type] || type;
      if (!grid || grid.length === 0 || grid.every(r => r.every(c => c === null))) {
        return `<div class="text-center text-muted font-italic my-3">
          No ${label} courses found.
        </div>`;
      }
      const suffix = type === 'prereq' ? '_p' : '_s';
      let html = `<table class="graph-section-table" style="width:100%; border-collapse: separate; margin: 0 auto;">`;
      grid.forEach(row => {
        html += `<tr>`;
        row.forEach((cell, idx) => {
          const width = idx % 2 === 0 ? '60px' : '40px';
          let content = '';
          if (cell) {
            const name = (nameMapping && nameMapping[cell]) ? nameMapping[cell] : "Unknown Course";
            const isCurrent = cell === courseId;
            const style = isCurrent ? "font-weight:bold; text-decoration:underline;" : "";
            content = `<a href="/course/${cell}" class="tooltip-link" id="${cell}${suffix}" style="${style}">${cell}<span class="tooltip-text">${name}</span></a>`;
          }
          html += `<td style="width:${width}; text-align:center; vertical-align:middle; height: 50px;">${content}</td>`;
        });
        html += `</tr>`;
      });
      html += `</table>`;
      return html;
    }

    function drawSVGLines(grid, type) {
      if (!grid || !graphData || !graphData.edges) return;
      const suffix = type === 'prereq' ? '_p' : '_s';
      const svg = document.getElementById('graph-svg');

      const wrapper = document.getElementById('svg-wrapper');
      if (!wrapper) return; // Safety check
      const wrapperRect = wrapper.getBoundingClientRect();

      graphData.edges.forEach(edge => {
        const startElem = document.getElementById(edge.source + suffix);
        const endElem = document.getElementById(edge.target + suffix);

        if (startElem && endElem) {
          const startRect = startElem.getBoundingClientRect();
          const endRect = endElem.getBoundingClientRect();

          // Calculate center points
          const startCenterX = startRect.left + startRect.width / 2;
          const startCenterY = startRect.top + startRect.height / 2;
          const endCenterX = endRect.left + endRect.width / 2;
          const endCenterY = endRect.top + endRect.height / 2;

          let x1, y1, x2, y2;

          // --- CONFIGURATION ---
          const gap = 6; // The fixed distance (in pixels) the arrow starts/ends away from the text

          // Default Y to vertical center
          y1 = startCenterY - wrapperRect.top;
          y2 = endCenterY - wrapperRect.top;

          // Determine the direction of the line to attach to the correct edges
          if (endCenterX > startCenterX + 10) {
            // Flows Left to Right (Standard)
            x1 = (startRect.right + gap) - wrapperRect.left;
            x2 = (endRect.left - gap) - wrapperRect.left;
          } else if (startCenterX > endCenterX + 10) {
            // Flows Right to Left
            x1 = (startRect.left - gap) - wrapperRect.left;
            x2 = (endRect.right + gap) - wrapperRect.left;
          } else {
            // Vertical line (same column)
            x1 = startCenterX - wrapperRect.left;
            x2 = endCenterX - wrapperRect.left;

            if (endCenterY > startCenterY) {
              // Top to Bottom
              y1 = (startRect.bottom + gap) - wrapperRect.top;
              y2 = (endRect.top - gap) - wrapperRect.top;
            } else {
              // Bottom to Top
              y1 = (startRect.top - gap) - wrapperRect.top;
              y2 = (endRect.bottom + gap) - wrapperRect.top;
            }
          }

          // Create SVG Line
          const newLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
          newLine.setAttribute('x1', x1);
          newLine.setAttribute('y1', y1);
          newLine.setAttribute('x2', x2);
          newLine.setAttribute('y2', y2);
          newLine.setAttribute('stroke', 'rgba(100, 100, 100, 0.4)'); // Grey color
          newLine.setAttribute('stroke-width', '2');
          newLine.setAttribute('marker-end', 'url(#arrowhead)');

          svg.appendChild(newLine);
        }
      });
    }
  });
</script>

<br>
<br>
<br>

{% endblock %}